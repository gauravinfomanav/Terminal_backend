openapi: 3.0.3
info:
  title: Stock Watchlist API
  description: |
    A comprehensive REST API for managing stock watchlists in a terminal application.
    
    This API allows users to:
    - Create and manage multiple watchlists
    - Add and remove stocks from watchlists
    - Track stock information including ticker symbols and prices
    - Monitor watchlist performance
    
    The API uses Firebase Firestore for data persistence and provides real-time updates.
  version: 1.0.0
  contact:
    name: Stock Watchlist API Support
    email: support@musaffa.us
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: https://terminal.musaffa.us
    description: Production server
  - url: http://localhost:3000
    description: Development server

paths:
  /health:
    get:
      summary: Health Check
      description: Verify that the API service is running and responsive
      tags:
        - System
      responses:
        '200':
          description: Service is healthy and operational
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                    description: Indicates the service status
                  message:
                    type: string
                    example: API is running
                    description: Human-readable status message
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-01-17T10:30:00.000Z"
                    description: Current server timestamp

  /watchlists:
    get:
      summary: Get All Watchlists
      description: Retrieve a list of all watchlists for the authenticated user
      tags:
        - Watchlists
      responses:
        '200':
          description: Successfully retrieved watchlists
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Watchlist'
                    description: Array of user's watchlists
                  count:
                    type: integer
                    minimum: 0
                    example: 3
                    description: Total number of watchlists
                  default_watchlist_id:
                    type: string
                    nullable: true
                    example: "watchlist_1758125631041"
                    description: ID of the user's default watchlist (null if none set)
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      summary: Create New Watchlist
      description: Create a new watchlist with the specified name
      tags:
        - Watchlists
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                  example: "My Tech Portfolio"
                  description: Name of the watchlist
            examples:
              tech_portfolio:
                summary: Technology Portfolio
                value:
                  name: "Technology Stocks"
              energy_sector:
                summary: Energy Sector
                value:
                  name: "Energy Sector Watchlist"
      responses:
        '201':
          description: Watchlist created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                  message:
                    type: string
                    example: "Watchlist created successfully"
                  data:
                    $ref: '#/components/schemas/Watchlist'
        '400':
          description: Bad request - Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /watchlists/{watchlistId}/stocks:
    get:
      summary: Get Stocks in Watchlist
      description: Retrieve all stocks within a specific watchlist
      tags:
        - Stocks
      parameters:
        - name: watchlistId
          in: path
          required: true
          description: Unique identifier of the watchlist
          schema:
            type: string
          example: "watchlist_1758125631041"
      responses:
        '200':
          description: Successfully retrieved stocks from watchlist
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Stock'
                    description: Array of stocks in the watchlist
                  count:
                    type: integer
                    minimum: 0
                    example: 5
                    description: Total number of stocks in the watchlist
        '404':
          description: Watchlist not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      summary: Add Stocks to Watchlist
      description: |
        Add one or multiple stocks to the specified watchlist.
        
        **Consistent Structure:**
        Always send a JSON object with a `stocks` array containing stock objects.
        - For single stock: `{"stocks": [{"ticker": "AAPL", "current_price": 150.25}]}`
        - For multiple stocks: `{"stocks": [{"ticker": "AAPL", "current_price": 150.25}, {"ticker": "TSLA", "current_price": 240.30}]}`
      tags:
        - Stocks
      parameters:
        - name: watchlistId
          in: path
          required: true
          description: Unique identifier of the watchlist
          schema:
            type: string
          example: "watchlist_1758125631041"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - stocks
              properties:
                stocks:
                  type: array
                  minItems: 1
                  description: Array of stocks to add to the watchlist (can contain one or multiple stocks)
                  items:
                    type: object
                    required:
                      - ticker
                    properties:
                      ticker:
                        type: string
                        pattern: '^[A-Z]{1,5}$'
                        example: "AAPL"
                        description: Stock ticker symbol (1-5 uppercase letters)
                      current_price:
                        type: number
                        format: float
                        minimum: 0
                        example: 150.25
                        description: Current market price of the stock
            examples:
              single_stock:
                summary: Single Stock Addition
                description: Add one stock to the watchlist
                value:
                  stocks:
                    - ticker: "AAPL"
                      current_price: 150.25
              multiple_stocks:
                summary: Multiple Stocks Addition
                description: Add multiple stocks to the watchlist
                value:
                  stocks:
                    - ticker: "AAPL"
                      current_price: 150.25
                    - ticker: "NVDA"
                      current_price: 450.80
                    - ticker: "GOOGL"
                      current_price: 2800.50
              tech_portfolio:
                summary: Technology Portfolio
                description: Add multiple tech stocks
                value:
                  stocks:
                    - ticker: "AAPL"
                      current_price: 150.25
                    - ticker: "MSFT"
                      current_price: 380.75
                    - ticker: "NVDA"
                      current_price: 450.80
                    - ticker: "TSLA"
                      current_price: 240.30
      responses:
        '201':
          description: Stock(s) added to watchlist successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                  message:
                    type: string
                    example: "Watchlist updated successfully"
                  data:
                    type: object
                    properties:
                      added_stocks:
                        type: array
                        items:
                          $ref: '#/components/schemas/Stock'
                        description: Successfully added stocks
                      errors:
                        type: array
                        items:
                          type: object
                          properties:
                            ticker:
                              type: string
                              example: "INVALID"
                            error:
                              type: string
                              example: "Ticker is required for each stock"
                        description: Failed stock additions with error details
                      total_requested:
                        type: integer
                        minimum: 0
                        example: 3
                        description: Total number of stocks requested
                      successfully_added:
                        type: integer
                        minimum: 0
                        example: 3
                        description: Number of stocks successfully added
                      failed:
                        type: integer
                        minimum: 0
                        example: 0
                        description: Number of stocks that failed to add
              examples:
                single_stock_response:
                  summary: Single Stock Addition Response
                  value:
                    status: "success"
                    message: "Watchlist updated successfully"
                    data:
                      added_stocks:
                        - id: "AAPL"
                          ticker: "AAPL"
                          current_price: 150.25
                          date_added: "2024-01-17T10:30:00.000Z"
                      errors: []
                      total_requested: 1
                      successfully_added: 1
                      failed: 0
                multiple_stocks_response:
                  summary: Multiple Stocks Addition Response
                  value:
                    status: "success"
                    message: "Watchlist updated successfully"
                    data:
                      added_stocks:
                        - id: "AAPL"
                          ticker: "AAPL"
                          current_price: 150.25
                          date_added: "2024-01-17T10:30:00.000Z"
                        - id: "NVDA"
                          ticker: "NVDA"
                          current_price: 450.80
                          date_added: "2024-01-17T10:30:00.000Z"
                        - id: "GOOGL"
                          ticker: "GOOGL"
                          current_price: 2800.50
                          date_added: "2024-01-17T10:30:00.000Z"
                      errors: []
                      total_requested: 3
                      successfully_added: 3
                      failed: 0
                partial_success_response:
                  summary: Partial Success Response
                  value:
                    status: "success"
                    message: "Watchlist updated successfully"
                    data:
                      added_stocks:
                        - id: "AAPL"
                          ticker: "AAPL"
                          current_price: 150.25
                          date_added: "2024-01-17T10:30:00.000Z"
                        - id: "NVDA"
                          ticker: "NVDA"
                          current_price: 450.80
                          date_added: "2024-01-17T10:30:00.000Z"
                      errors:
                        - ticker: "INVALID"
                          error: "Ticker is required for each stock"
                      total_requested: 3
                      successfully_added: 2
                      failed: 1
        '400':
          description: Bad request - Invalid stock data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Watchlist not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /watchlists/{watchlistId}/stocks/{ticker}:
    delete:
      summary: Remove Stock from Watchlist
      description: Remove a specific stock from the watchlist using its ticker symbol
      tags:
        - Stocks
      parameters:
        - name: watchlistId
          in: path
          required: true
          description: Unique identifier of the watchlist
          schema:
            type: string
          example: "watchlist_1758125631041"
        - name: ticker
          in: path
          required: true
          description: Stock ticker symbol to remove
          schema:
            type: string
            pattern: '^[A-Z]{1,5}$'
          example: "AAPL"
      responses:
        '200':
          description: Stock removed from watchlist successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                  message:
                    type: string
                    example: "Stock removed from watchlist"
                  data:
                    type: object
                    properties:
                      ticker:
                        type: string
                        example: "AAPL"
                        description: The removed stock's ticker symbol
        '404':
          description: Watchlist or stock not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/preferences:
    get:
      summary: Get User Preferences
      description: Retrieve user preferences including default watchlist settings
      tags:
        - User Preferences
      responses:
        '200':
          description: User preferences retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                  data:
                    $ref: '#/components/schemas/UserPreferences'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/preferences/default-watchlist:
    put:
      summary: Set Default Watchlist
      description: Set a specific watchlist as the user's default watchlist
      tags:
        - User Preferences
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - watchlist_id
              properties:
                watchlist_id:
                  type: string
                  example: "watchlist_1758125631041"
                  description: ID of the watchlist to set as default
            examples:
              set_default:
                summary: Set Default Watchlist
                value:
                  watchlist_id: "watchlist_1758125631041"
      responses:
        '200':
          description: Default watchlist set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                  message:
                    type: string
                    example: "Default watchlist set successfully"
                  data:
                    $ref: '#/components/schemas/UserPreferences'
        '400':
          description: Bad request - Missing watchlist ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Watchlist not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: Remove Default Watchlist
      description: Remove the current default watchlist setting (user will need to manually select watchlists)
      tags:
        - User Preferences
      responses:
        '200':
          description: Default watchlist removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                    example: success
                  message:
                    type: string
                    example: "Default watchlist removed successfully"
                  data:
                    type: object
                    properties:
                      user_id:
                        type: string
                        example: "user123"
                      default_watchlist_id:
                        type: string
                        nullable: true
                        example: null
                        description: Now set to null
                      last_updated:
                        type: string
                        format: date-time
                        example: "2024-01-17T10:30:00.000Z"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Watchlist:
      type: object
      description: A collection of stocks that a user wants to monitor
      properties:
        id:
          type: string
          example: "watchlist_1758125631041"
          description: Unique identifier for the watchlist
        name:
          type: string
          example: "My Tech Portfolio"
          description: Human-readable name of the watchlist
        date_created:
          type: string
          format: date-time
          example: "2024-01-17T10:30:00.000Z"
          description: Timestamp when the watchlist was created
        stock_count:
          type: integer
          minimum: 0
          example: 5
          description: Number of stocks currently in the watchlist
        is_default:
          type: boolean
          example: true
          description: Whether this watchlist is set as the user's default
      required:
        - id
        - name
        - date_created
        - stock_count
        - is_default

    Stock:
      type: object
      description: A stock entry within a watchlist
      properties:
        id:
          type: string
          example: "AAPL"
          description: Unique identifier (same as ticker)
        ticker:
          type: string
          pattern: '^[A-Z]{1,5}$'
          example: "AAPL"
          description: Stock ticker symbol
        current_price:
          type: number
          format: float
          minimum: 0
          example: 150.25
          description: Current market price of the stock
        date_added:
          type: string
          format: date-time
          example: "2024-01-17T10:30:00.000Z"
          description: Timestamp when the stock was added to the watchlist
      required:
        - id
        - ticker
        - current_price
        - date_added

    UserPreferences:
      type: object
      description: User preferences including default watchlist settings
      properties:
        user_id:
          type: string
          example: "user123"
          description: Unique identifier for the user
        default_watchlist_id:
          type: string
          nullable: true
          example: "watchlist_1758125631041"
          description: ID of the user's default watchlist (null if none set)
        date_set:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-17T10:30:00.000Z"
          description: Timestamp when the default watchlist was first set
        last_updated:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-17T10:30:00.000Z"
          description: Timestamp when preferences were last updated
      required:
        - user_id
        - default_watchlist_id
        - date_set
        - last_updated

    Error:
      type: object
      description: Error response format
      properties:
        status:
          type: string
          enum: [error]
          example: error
          description: Indicates an error occurred
        message:
          type: string
          example: "Watchlist not found"
          description: Human-readable error message
      required:
        - status
        - message

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for API authentication

security:
  - bearerAuth: []

tags:
  - name: System
    description: System health and status endpoints
  - name: Watchlists
    description: Watchlist management operations
  - name: Stocks
    description: Stock management within watchlists
  - name: User Preferences
    description: User preference management including default watchlist settings